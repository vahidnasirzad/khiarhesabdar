{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/vahidnasirzad/my-accounting-app/app/add-invoice/page.tsx"],"sourcesContent":["// app/add-invoice/page.tsx\n\n'use client'; \nimport React, { useState, CSSProperties, FormEvent, ChangeEvent } from 'react';\nimport { useRouter } from 'next/navigation'; \nimport DatePicker, { DateObject } from 'react-multi-date-picker'; \nimport persian from 'react-date-object/calendars/persian';\nimport persian_fa from 'react-date-object/locales/persian_fa';\nimport gregorian from 'react-date-object/calendars/gregorian';\nimport moment from 'moment-jalaali';\n\n// FIX: Define a type for the styles object using a Record type\ntype StyleMap = Record<string, CSSProperties>;\n\nexport default function AddInvoice() {\n  const router = useRouter();\n  // State for form fields\n  const [form, setForm] = useState({\n    date: new Date(),\n    title: '',\n    description: '',\n    amount: '',\n    store_name: '',\n    type: '',\n    category: '',\n    has_receipt: false,\n    has_invoice: false,\n  });\n\n  // State for button lock and errors\n  const [shamsiPreview, setShamsiPreview] = useState(moment(form.date).format('jYYYY/jMM/jDD'));\n  const [error, setError] = useState('');\n  // üí• NEW STATE: Controls the disabled state of the submit button\n  const [isSubmitting, setIsSubmitting] = useState(false); \n\n  // FIX: Use ChangeEvent with a union type and safe type assertion for 'checked'\n  const handleChange = (e: ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\n    const target = e.target as HTMLInputElement;\n    const { name, value, type, checked } = target;\n    setForm({ ...form, [name]: type === 'checkbox' ? checked : value });\n  };\n\n  // FIX: Type dateObj using the imported DateObject type and include null\n  const handleDateChange = (dateObj: DateObject | null) => {\n    if (!dateObj) return;\n\n    // Convert Shamsi ‚Üí Gregorian\n    const gregorianDate = dateObj.convert(gregorian).toDate();\n    setForm({ ...form, date: gregorianDate });\n\n    const shamsi = moment(gregorianDate).format('jYYYY/jMM/jDD');\n    setShamsiPreview(shamsi);\n\n    console.log('üìÖ Gregorian (for DB):', moment(gregorianDate).format('YYYY-MM-DD'));\n    console.log('üóìÔ∏è Shamsi preview:', shamsi);\n  };\n\n  // FIX: Explicitly type 'e' as a React Form Event\n  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n\n    // üí• 1. Check if submission is currently locked\n    if (isSubmitting) return;\n\n    // üí• 2. Lock the button immediately\n    setIsSubmitting(true);\n    setError('');\n\n    // üí• 3. Start the 5-second cooldown timer\n    const COOLDOWN_MS = 5000;\n    const timeoutId = setTimeout(() => {\n        console.log(`‚úÖ Cooldown finished. Re-enabling submit button after ${COOLDOWN_MS / 1000} seconds.`);\n        setIsSubmitting(false);\n    }, COOLDOWN_MS);\n\n    try {\n      // Sending the Gregorian date in standard YYYY-MM-DD format for API route to consume\n      const payload = { ...form, date: moment(form.date).format('YYYY-MM-DD') };\n      \n      const res = await fetch('/api/invoices', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload)\n      });\n      \n      if (res.ok) {\n        // Clear the cooldown timer if successful, as we are navigating away\n        clearTimeout(timeoutId); \n        router.push('/invoices');\n      } else {\n        const data = await res.json();\n        setError(data.message || 'ÿÆÿ∑ÿß ÿØÿ± ÿ´ÿ®ÿ™ ŸÅÿß⁄©ÿ™Ÿàÿ±');\n        // If submission fails, the cooldown will still finish in 5 seconds\n      }\n    } catch (err) {\n      console.error(err);\n      setError('ÿÆÿ∑ÿß ÿØÿ± ÿßÿ™ÿµÿßŸÑ ÿ®Ÿá ÿ≥ÿ±Ÿàÿ±');\n      // If fetch fails completely, the cooldown will still finish in 5 seconds\n    }\n    \n    // Note: The button is re-enabled by the setTimeout, not a final state update here.\n  };\n\n  return (\n    <div style={styles.container}>\n      <button \n        onClick={() => router.push('/invoices')} \n        style={styles.backButton}\n      >\n        ŸÑ€åÿ≥ÿ™ ŸÅÿß⁄©ÿ™Ÿàÿ±Ÿáÿß üìã\n      </button>\n\n\n      <h2 style={styles.heading}>ÿßŸÅÿ≤ŸàÿØŸÜ ŸÅÿß⁄©ÿ™Ÿàÿ±</h2>\n      <form onSubmit={handleSubmit} style={styles.form}>\n\n        <div style={styles.formGroup}>\n          <label style={styles.label}>ÿ™ÿßÿ±€åÿÆ:</label>\n          <DatePicker\n            value={shamsiPreview}\n            onChange={handleDateChange}\n            calendar={persian}\n            locale={persian_fa}\n            format=\"YYYY/MM/DD\"\n            style={styles.datePickerInput}\n          />\n        </div>\n\n        <div style={styles.formGroup}>\n          <label style={styles.label}>ÿπŸÜŸàÿßŸÜ:</label>\n          <input type=\"text\" name=\"title\" value={form.title} onChange={handleChange} style={styles.input} required />\n        </div>\n\n        <div style={styles.formGroup}>\n          <label style={styles.label}>ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™:</label>\n          <input type=\"text\" name=\"description\" value={form.description} onChange={handleChange} style={styles.input} />\n        </div>\n\n        <div style={styles.formGroup}>\n          <label style={styles.label}>ŸÖÿ®ŸÑÿ∫ (ÿ±€åÿßŸÑ):</label>\n          <input type=\"number\" name=\"amount\" value={form.amount} onChange={handleChange} style={styles.input} required />\n        </div>\n\n        <div style={styles.formGroup}>\n          <label style={styles.label}>ŸÜÿßŸÖ ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá:</label>\n          <input type=\"text\" name=\"store_name\" value={form.store_name} onChange={handleChange} style={styles.input} required />\n        </div>\n\n        <div style={styles.formGroup}>\n          <label style={styles.label}>ŸÜŸàÿπ:</label>\n          <select name=\"type\" value={form.type} onChange={handleChange} style={styles.input} required>\n            <option value=\"\">ÿßŸÜÿ™ÿÆÿßÿ® ŸÜŸàÿπ</option>\n            <option value=\"ŸÖÿµÿ±ŸÅ€å\">ŸÖÿµÿ±ŸÅ€å</option>\n            <option value=\"ÿßŸÖŸàÿßŸÑ\">ÿßŸÖŸàÿßŸÑ</option>\n            <option value=\"ŸÖÿµÿ±ŸÅ€å-ÿßŸÖŸàÿßŸÑ\">ŸÖÿµÿ±ŸÅ€å-ÿßŸÖŸàÿßŸÑ</option>\n          </select>\n        </div>\n\n        <div style={styles.formGroup}>\n          <label style={styles.label}>ÿØÿ≥ÿ™Ÿá:</label>\n          <select name=\"category\" value={form.category} onChange={handleChange} style={styles.input} required>\n            <option value=\"\">ÿßŸÜÿ™ÿÆÿßÿ® ÿØÿ≥ÿ™Ÿá</option>\n            <option value=\"IMP\">IMP</option>\n            <option value=\"Milling CNC\">Milling CNC</option>\n            <option value=\"PPS\">PPS</option>\n            <option value=\"General\">ŸÖÿ¥ÿ™ÿ±⁄©</option>\n          </select>\n        </div>\n\n        <div style={styles.formGroupCheckbox}>\n          <label>\n            <input type=\"checkbox\" name=\"has_receipt\" checked={form.has_receipt} onChange={handleChange} />\n            ÿ±ÿ≥€åÿØ ÿØÿßÿ±ÿØ\n          </label>\n        </div>\n\n        <div style={styles.formGroupCheckbox}>\n          <label>\n            <input type=\"checkbox\" name=\"has_invoice\" checked={form.has_invoice} onChange={handleChange} />\n            ŸÅÿß⁄©ÿ™Ÿàÿ± ÿØÿßÿ±ÿØ\n          </label>\n        </div>\n\n        {/* üí• 4. Disable the button when isSubmitting is true */}\n        <button \n            type=\"submit\" \n            style={{...styles.button, opacity: isSubmitting ? 0.6 : 1}} \n            disabled={isSubmitting}\n        >\n            {isSubmitting ? 'ÿØÿ± ÿ≠ÿßŸÑ ÿ´ÿ®ÿ™... ŸÑÿ∑ŸÅÿß ÿµÿ®ÿ± ⁄©ŸÜ€åÿØ ' : 'ÿ´ÿ®ÿ™ ŸÅÿß⁄©ÿ™Ÿàÿ±'}\n        </button>\n        \n        {error && <p style={styles.error}>{error}</p>}\n      </form>\n    </div>\n  );\n}\n\n\n// FIX: Apply the StyleMap type to the styles object definition\nconst styles: StyleMap = {\n  container: { \n    maxWidth: '600px', \n    margin: '50px auto', \n    padding: '30px', \n    borderRadius: '10px',\n    backgroundColor: 'rgba(255, 255, 255, 0.95)', \n    boxShadow: '0 4px 20px rgba(0,0,0,0.3)', \n    color: '#333', \n  },\n  heading: { textAlign: 'center', marginBottom: '20px', color: '#333' },\n  form: { display: 'flex', flexDirection: 'column', gap: '15px' },\n  formGroup: { display: 'flex', flexDirection: 'column' },\n  formGroupCheckbox: { marginBottom: '10px' },\n  label: { marginBottom: '5px', fontWeight: 'bold', color: '#555' },\n  input: { padding: '10px', borderRadius: '5px', border: '1px solid #ccc', fontSize: '16px' },\n  button: { padding: '12px',\n    fontFamily: 'Lalezar, Tahoma, sans-serif',\n    borderRadius: '5px', border: 'none', backgroundColor: 'green', color: 'white', fontSize: '16px', cursor: 'pointer',\n    transition: 'opacity 0.3s' // Added transition for smoother visual change\n  },\n  error: { color: 'red', marginTop: '10px' },\n\n  backButton: { \n    padding: '12px', \n    borderRadius: '5px', \n    border: 'none', \n    backgroundColor: '#4a90e2', \n    color: 'white', \n    fontSize: '16px', \n    cursor: 'pointer',\n    fontFamily: 'Lalezar, Tahoma, sans-serif',\n    marginTop: '10px',\n  },\n  \n  // FIX: Moved inline style from DatePicker to the styles object\n  datePickerInput: {\n    width: '100%',\n    padding: '10px',\n    fontSize: '16px',\n    border: '1px solid #ccc',\n    borderRadius: '5px'\n  }\n};\n"],"names":[],"mappings":"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","debugId":null}}]
}